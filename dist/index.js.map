{"version":3,"file":"index.js","sources":["../src/utilities/getTypeString.js","../src/utilities/HttpError.js","../src/authenticators/basicAuthenticator.js","../src/authenticators/bearerTokenAuthenticator.js","../src/authenticators/requestAuthenticator.js","../src/utilities/joinWithSingle.js","../src/utilities/parseBody.js","../src/utilities/WritableBufferStream.js","../src/utilities/responseWrapper.js","../src/Router.js","../src/utilities/makeEndpoint.js"],"sourcesContent":["export function getTypeString(data) {\n  const stringType = typeof data;\n  if (stringType === 'object') {\n    if (data === null) return 'null';\n    const stringified = toString.apply(data);\n    if (stringified.length > 2 && stringified[0] === '[' && stringified[stringified.length - 1] === ']') {\n      const splits = stringified.substr(1, stringified.length - 2).split(' ');\n      if (splits.length > 1) {\n        return splits.slice(1).join(' ').toLowerCase();\n      }\n    }\n    return 'unknown';\n  }\n\n  if (stringType === 'number') {\n    if (isNaN(data)) return 'nan';\n  }\n\n  return stringType;\n}\n","import { getTypeString } from './getTypeString';\n\nexport class HttpError {\n  constructor({ status, message, data }) {\n    this.name = 'HTTP Error';\n    this.status = status;\n    this.message = message;\n    this.data = data;\n  }\n}\n\nexport function stringifyError(error) {\n  if (error instanceof Error) {\n    return JSON.stringify(error, Object.getOwnPropertyNames(error));\n  } else {\n    return JSON.stringify(error);\n  }\n}\n\nexport function applyHttpError(request, response, error) {\n  const status = error?.status || 500;\n  const message = error?.message || 'Uncaught Error Without Message';\n  const data = error?.data || {};\n\n  response.status(status);\n\n  if (getTypeString(message) === 'object') {\n    response.json(Object.assign(data, message));\n  } else if (message) {\n    response.json(Object.assign(data, { message }));\n  } else {\n    response.send(stringifyError(error));\n  }\n}\n","import { HttpError } from '../utilities/HttpError';\n\n/**\n * pass an array of users with usernames and passwords, any additional data included in the subobjects will be passed in as well as the identity parameter into your endpoint\n * @param {[{ username: string, password: string }]} users\n */\nexport function makeHardcodedBasicAuthenticator(users) {\n  const usersByUsername = {};\n  for (let user of users) {\n    usersByUsername[user.username] = user;\n  }\n\n  const getUser = ({ username, password }) => {\n    const user = usersByUsername[username];\n    if (user && user.password === password) {\n      return user;\n    }\n\n    return null;\n  }\n\n  return makeBasicAuthenticator(getUser);\n}\n\nexport function makeBasicAuthenticator(getUserFromCredentialsFunction) {\n  return async ({ headers }) => {\n    if (!headers.authorization) {\n      console.log(headers);\n      throw new HttpError({ status: 401, message: 'Missing Authentication' });\n    }\n\n    if (headers.authorization.toLowerCase().indexOf('basic') !== 0) {\n      throw new HttpError({ status: 405, message: 'Incorrect Authentication' });\n    }\n\n    const auth = headers.authorization.replace(/^basic\\s+/gi, '');\n    const encoded = Buffer.from(auth, 'base64');\n    const decoded = encoded.toString('utf-8');\n    const colonPosition = decoded.indexOf(':');\n    const username = decoded.substr(0, colonPosition);\n    const password = decoded.substr(colonPosition + 1);\n\n    const user = await getUserFromCredentialsFunction({ username, password });\n    console.log({ auth, encoded, decoded, colonPosition, username, password, user })\n\n    if (!user) {\n      throw new HttpError({ status: 401, message: 'Incorrect Credentials' });\n    }\n\n    return user;\n  }\n}\n","import { HttpError } from '../utilities/HttpError';\n\nexport function makeBearerTokenAuthenticator(getUserFromBearerFunction) {\n  return async ({ headers }) => {\n    if (!headers.authorization) {\n      throw new HttpError({ status: 401, message: 'Missing Authentication' });\n    }\n\n    if (headers.authorization.toLowerCase().indexOf('bearer') !== 0) {\n      throw new HttpError({ status: 405, message: 'Incorrect Authentication' });\n    }\n\n    const token = headers.authorization.replace(/^bearer\\s+/gi, '');\n\n    const identity = await getUserFromBearerFunction(token);\n    if (!identity) {\n      throw new HttpError({ status: 401, message: 'Incorrect Credentials' });\n    }\n\n    return identity;\n  }\n}\n","import { HttpError } from '../utilities/HttpError';\n\nexport function makeRequestAuthenticator(getUserFromRequest) {\n  return async (params) => {\n    const identity = await getUserFromRequest(params);\n    if (!identity) {\n      throw new HttpError({ status: 401, message: 'Incorrect Credentials' });\n    }\n\n    return identity;\n  }\n}\n","function findIndexInDirection(string, predicate, direction = 1) {\n  if (direction > 0) {\n    for (let dex = 0; dex < string.length; dex += 1) {\n      if (predicate(string[dex], dex)) return dex;\n    }\n  } else {\n    for (let dex = string.length - 1; dex >= 0; dex -= 1) {\n      if (predicate(string[dex], dex)) return dex + 1;\n    }\n  }\n\n  return null;\n}\n\nexport function joinWithSingle(parts, joiner) {\n  if (!joiner) return parts.join('');\n\n  const cleanedPartArray = parts.map((item, dex) => {\n    const firstNonJoiner = dex === 0 ? 0 : findIndexInDirection(item, (letter => (letter !== joiner)), 1);\n    const finalNonJoiner = dex === parts.length - 1 ? item.length : findIndexInDirection(item, (letter => letter !== joiner), -1);\n    return item.slice(firstNonJoiner, finalNonJoiner);\n  });\n\n  return cleanedPartArray.join(joiner);\n}\n","import { getTypeString } from './getTypeString';\n\nconst startingChars = {\n  '{': 'json',\n  '[': 'json',\n  '<': 'xml',\n};\n\nexport function parseBody(input) {\n  if (!input) return null;\n  const inputType = getTypeString(input);\n  if (inputType === 'string') {\n    const startingType = startingChars[input[0]];\n    if (startingType === 'json') {\n      try {\n        const output = JSON.parse(input);\n        return output;\n      } catch (err) {\n        // not json\n      }\n    }\n\n    const sections = input.split('&');\n    const output = {};\n    for (let section of sections) {\n      const parts = section.split('=').map(item => decodeURIComponent(item));\n      output[parts[0]] = parts[1];\n    }\n    return output;\n  }\n\n  if (inputType === 'array' || inputType === 'object') {\n    return input;\n  }\n\n\n\n  throw new HttpError({ status: 500, message: `issue parsing body, it came in as ${inputType}, but string is the only supported method` })\n}\n","import { Writable } from 'stream';\n\nexport class WritableBufferStream extends Writable {\n  buffer = Buffer.alloc(0);\n  constructor(callback, options) {\n    super(options);\n    this.callback = callback;\n  }\n\n  _write(chunk, encoding, callback) {\n    if (chunk) {\n      this.buffer = Buffer.concat([this.buffer, chunk]);\n    }\n\n    callback();\n  }\n\n  _final(callback) {\n    this.callback(this.buffer);\n    callback();\n  }\n\n  _destroy() {\n    this.buffer = null;\n  }\n}\n","import { applyHttpError, HttpError } from './HttpError';\nimport { parseBody } from './parseBody';\nimport { WritableBufferStream } from './WritableBufferStream';\n\nfunction getParams(keyList, { body, query }) {\n  const missing = [];\n  const data = {};\n  for (let key of keyList) {\n    if (body?.[key] !== undefined) {\n      data[key] = body[key];\n    } else if (query?.[key] !== undefined) {\n      data[key] = query[key];\n    } else {\n      missing.push(key);\n    }\n  }\n  return { missing, data };\n}\n\nfunction collectBody(request) {\n  return new Promise((resolve, reject) => {\n    const output = new WritableBufferStream(resolve);\n    output.on('error', reject);\n    request.pipe(output);\n  });\n}\n\n/**\n *\n * @param {function} func\n * @param {{ authenticator: function }} config\n */\nexport function responseWrapper(func, config, apinionRouter) {\n  if (typeof func !== 'function') {\n    if (typeof config === 'function') {\n      func = config;\n      config = {};\n\n      // we COULD throw here, but it's perhaps better to just let people do what they want\n    } else {\n      throw new Error('endpoint executor must be a function check config (this happens when you use makeEndpoint inside of a get/post/any, or if you forget the config parameter) ' + JSON.stringify(config));\n    }\n  }\n\n  return async (request, response) => {\n    try {\n      if (!config.noParse) {\n        request.raw = await collectBody(request);\n        const body = parseBody(request.raw.toString());\n        request.body = body;\n      }\n      const params = { request, response, body: config.noParse ? undefined : request.body, query: request.query, headers: request.headers, params: Object.assign({}, request.query || {}, request.body || {}) };\n      if (config.authenticator) {\n        params.identity = await config.authenticator(params);\n      }\n      if (config.required) {\n        const { missing, data } = getParams(config.required, params);\n\n        if (missing.length > 0) {\n          throw new HttpError({ status: 400, message: `missing params: ${missing.map(item => `\"${item}\"`).join(', ')}` });\n        }\n\n        params.required = data;\n      }\n      if (config.hidden_required) {\n        const { missing, data } = getParams(config.hidden, params);\n\n        if (missing.length > 0) {\n          throw new HttpError({ status: 400, message: 'your request is incomplete (this is probably because you are missing some essential hidden requirement)' });\n        }\n\n        params.hidden = data;\n      }\n      const endpointResponse = await func(params);\n      if (!response._headerSent) {\n        if (typeof endpointResponse === 'string') {\n          response.send(endpointResponse);\n        } else {\n          response.json(endpointResponse);\n        }\n      }\n    } catch (err) {\n      try {\n        await config?.onError?.({ error: err, config, request, response });\n        await apinionRouter?.onError?.({ error: err, config, request, response });\n      } catch (subError) {\n        console.error(`custom error handler threw error (check your onError handler in your ${config?.route || request.originalUrl} endpoint) (check your apinionRouter.onError function)`, subError);\n      }\n\n      if (!response._headerSent) {\n        applyHttpError(request, response, err);\n      }\n    }\n  };\n}\n","import express from 'express';\nimport { joinWithSingle } from './utilities/joinWithSingle';\nimport { responseWrapper } from './utilities/responseWrapper';\n\nexport class Router {\n  /**\n   * @param {express} expressApp\n   * @param {Router} parent\n   * @param {string} baseDirectory\n   */\n  constructor(expressApp, parent, baseDirectory) {\n    this.parent = parent;\n    this.expressApp = expressApp || express();\n    this.baseDirectory = baseDirectory;\n    this.routes = {};\n  }\n\n  addErrorHandler = (callback) => {\n    this.onErrorCallback = callback;\n  }\n\n  onError = (...params) => {\n    if (this.onErrorCallback) {\n      return this.onErrorCallback(...params);\n    } else {\n      this.parent?.onError(...params);\n    }\n  }\n\n  setAuthenticator = (authenticator) => {\n    this.authenticator = authenticator;\n  }\n\n  getRoutes = () => {\n    const result = {};\n\n    const keyList = Object.keys(this.routes);\n\n    for (let key of keyList) {\n      const info = Object.assign({}, this.routes[key]);\n      if (info.subrouter) {\n        info.subrouter = info.subrouter.getRoutes?.();\n      }\n      result[key] = info;\n    }\n\n    return result;\n  }\n\n  getCleanedSubPath = (path) => {\n    const subPath = this.getSubPath(path);\n    if (subPath.length > 0 && subPath[0] !== '/') return '/' + subPath; // http://server.comFIX => http://server.com/FIX\n\n    return subPath;\n  }\n\n  getSubPath = (path) => {\n    if (!this.baseDirectory) return path;\n    if (path === '/') return this.baseDirectory;\n    return joinWithSingle([this.baseDirectory, path], '/');\n  }\n\n  describeSubroute = (subdirectory, meta) => {\n    if (!this.routes[subdirectory]) this.routes[subdirectory] = {};\n    Object.assign(this.routes[subdirectory], meta);\n  }\n\n  subrouter = (subdirectory) => {\n    const subRouter = new Router(this.expressApp, this, this.getCleanedSubPath(subdirectory));\n    subRouter.setAuthenticator(this.authenticator);\n    this.describeSubroute(subdirectory, { subrouter: subRouter });\n    return subRouter;\n  }\n\n  getResponseWrapper = (callback, config = {}) => {\n    if (this.authenticator && !config.authenticator) {\n      config.authenticator = this.authenticator;\n    }\n\n    return responseWrapper(callback, config, this);\n  }\n\n  makeRouteDetails = (type, route, config, callback) => {\n    const defaultedConfig = config || {};\n    const cleanedPath = this.getCleanedSubPath(route);\n    if (!defaultedConfig.route) defaultedConfig.route = cleanedPath;\n    this.describeSubroute(cleanedPath, { [type]: defaultedConfig });\n    let params = [cleanedPath];\n    if (defaultedConfig?.middleware) {\n      params = params.concat(defaultedConfig.middleware)\n    }\n    params.push(this.getResponseWrapper(callback, defaultedConfig));\n    return params;\n  }\n\n  get = (route, config, callback) => {\n    return this.expressApp.get(...this.makeRouteDetails('get', route, config, callback));\n  }\n  post = (route, config, callback) => {\n    return this.expressApp.post(...this.makeRouteDetails('post', route, config, callback));\n  }\n  put = (route, config, callback) => {\n    return this.expressApp.put(...this.makeRouteDetails('put', route, config, callback));\n  }\n  patch = (route, config, callback) => {\n    return this.expressApp.patch(...this.makeRouteDetails('patch', route, config, callback));\n  }\n  delete = (route, config, callback) => {\n    return this.expressApp.delete(...this.makeRouteDetails('delete', route, config, callback));\n  }\n  options = (route, config, callback) => {\n    return this.expressApp.options(...this.makeRouteDetails('options', route, config, callback));\n  }\n  any = (route, config, callback) => {\n    const params = this.makeRouteDetails('any', route, config, callback);\n\n    return [\n      this.expressApp.get(...params),\n      this.expressApp.put(...params),\n      this.expressApp.post(...params),\n      this.expressApp.patch(...params),\n      this.expressApp.delete(...params),\n      this.expressApp.options(...params),\n    ];\n  }\n  use = (...passthrough) => {\n    this.expressApp.use(...passthrough);\n  }\n  applyRoutes = (routes) => {\n    if (Array.isArray && !Array.isArray(routes)) {\n      routes = [routes];\n    }\n\n    for (let route of routes) {\n      const { path, executor, get, options, delete: deleteRoute, patch, post, put, subrouter, any } = route;\n\n      if (executor) this.any(path, executor.config, executor.callback);\n      if (any) this.any(path, any.config, any.callback);\n      if (get) this.get(path, get.config, get.callback);\n      if (post) this.post(path, post.config, post.callback);\n      if (options) this.options(path, options.config, options.callback);\n      if (patch) this.patch(path, patch.config, patch.callback);\n      if (put) this.put(path, put.config, put.callback);\n      if (deleteRoute) this.delete(path, deleteRoute.config, deleteRoute.callback);\n      if (subrouter) {\n        const sub = this.subrouter(path);\n        sub.applyRoutes(subrouter);\n      }\n    }\n  }\n  expressApp() {\n    return this.expressApp;\n  }\n  expressConnection() {\n    return this.expressConnection;\n  }\n  enableCors = (origin = '*', headers = 'Origin, X-Requested-With, Content-Type, Accept, Authorization') => {\n    this.expressApp.use((req, res, next) => {\n      res.header('Access-Control-Allow-Origin', origin);\n      res.header('Access-Control-Allow-Headers', headers);\n      next();\n    });\n    this.expressApp.options('*', (request, result) => result.status(200).send());\n  }\n  close = () => {\n    if (this.connection) {\n      this.connection.close();\n    }\n  }\n  listen = (port, callback) => {\n    return new Promise((resolve, reject) => {\n      this.connection = this.expressApp.listen(port, (results) => {\n        console.log('listening on port', port);\n        callback?.(results);\n        this.expressApp.removeListener('error', reject)\n        resolve(results);\n      });\n      this.expressApp.once('error', reject);\n      this.connection.keepAliveTimeout = 60 * 1000;\n      this.connection.headersTimeout = 61 * 1000;\n    });\n  }\n}\n","export function makeEndpoint(config, executionFunction) {\n  return {\n    config,\n    callback: executionFunction,\n  };\n}\n"],"names":["getTypeString","data","stringType","stringified","toString","apply","length","splits","substr","split","slice","join","toLowerCase","isNaN","HttpError","status","message","name","stringifyError","error","Error","JSON","stringify","Object","getOwnPropertyNames","applyHttpError","request","response","json","assign","send","makeHardcodedBasicAuthenticator","users","usersByUsername","user","username","getUser","password","makeBasicAuthenticator","getUserFromCredentialsFunction","headers","authorization","console","log","indexOf","auth","replace","encoded","Buffer","from","decoded","colonPosition","makeBearerTokenAuthenticator","getUserFromBearerFunction","token","identity","makeRequestAuthenticator","getUserFromRequest","params","findIndexInDirection","string","predicate","direction","dex","joinWithSingle","parts","joiner","cleanedPartArray","map","item","firstNonJoiner","letter","finalNonJoiner","startingChars","parseBody","input","inputType","startingType","output","parse","err","sections","section","decodeURIComponent","WritableBufferStream","callback","options","alloc","chunk","encoding","buffer","concat","Writable","getParams","keyList","body","query","missing","key","undefined","push","collectBody","Promise","resolve","reject","on","pipe","responseWrapper","func","config","apinionRouter","noParse","raw","authenticator","required","hidden_required","hidden","endpointResponse","_headerSent","onError","route","originalUrl","Router","expressApp","parent","baseDirectory","onErrorCallback","result","keys","routes","info","subrouter","getRoutes","path","subPath","getSubPath","subdirectory","meta","subRouter","getCleanedSubPath","setAuthenticator","describeSubroute","type","defaultedConfig","cleanedPath","middleware","getResponseWrapper","get","makeRouteDetails","post","put","patch","use","Array","isArray","executor","deleteRoute","any","sub","applyRoutes","origin","req","res","next","header","connection","close","port","listen","results","removeListener","once","keepAliveTimeout","headersTimeout","express","expressConnection","makeEndpoint","executionFunction"],"mappings":"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"}